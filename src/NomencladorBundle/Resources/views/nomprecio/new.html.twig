{% extends 'NomencladorBundle:Default:nom_base.html.twig' %}
{#{% block asiderigth %}"right-side strech"{% endblock %}#}
{% block css %}
    {{ parent() }}
    {#<link href="{{ asset('bundles/tercero/js/plugins/chosen/chosen.css') }}" rel="stylesheet" type="text/css"/>#}
    <link rel="stylesheet" href="{{ asset('bundles/tercero/css/auxiliar.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/tercero/js/jstree/dist/themes/default/style.min.css') }}"/>

    {#<link rel="stylesheet" href="{{ asset('bundles/tercero/js/split-pane-master/split-pane.css') }}"/>#}

    <link rel="stylesheet" href="{{ asset('bundles/tercero/js/jquery-easyui-1.5.2/themes/default/easyui.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/tercero/js/jquery-easyui-1.5.2/themes/icon.css') }}"/>
    {#<link rel="stylesheet" href="{{ asset('bundles/tercero/js/jquery-easyui-1.5.2/demo.css') }}"/>#}

{% endblock %}
  {% block titulo_cont %}
      <li><a href="{{ path('portada') }}">Inicio</a></li>
      <li><a>Nomencladores</a></li>
      <li><a href="{{ path('precio_index') }}">Precios</a></li>
      <li><a class="active">Nuevo</a></li>
  {% endblock %}

{% block contenido %}
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <div class="box box-primary ">
                    <div class="box-header">
                        <h3 class="box-title">{{ accion }}</h3>
                    </div>
                    <div class="box-body">
                        {{ form_start(form,{'attr':{ 'id':'form-precio' }}) }}
                        <div class="form-horizontal bootstrap-validator-form">
                            <fieldset>
                                <div class="easyui-layout row" style="height:400px;">

                                    <div class="col-xs-4">
                                        <div style="background-color: #E0ECFF; text-align: center; color: #0E2D5F">
                                            Grupos de Inter√©s
                                        </div>
                                        <div class="panel-body layout-body" style="height:380px;">
                                            <div class="portlet-body">
                                                <div class="row">
                                                    <input type="hidden" id="entidadSelected">

                                                    <div class="col-xs-12" style="height: 290px">
                                                        <div id="div_entidades_tree" class="col-xs-3"></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="portlet-body">
                                                <div class="row">
                                                    <input type="hidden" id="entidadSelected">

                                                    <div class="col-xs-12">
                                                        <div id="div_entidades_tree" class="col-xs-3"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-5">
                                        <div style="background-color: #E0ECFF; text-align: center; color: #0E2D5F">
                                            Productos
                                        </div>
                                        <div class="panel-body layout-body" style="height:380px;">
                                            <div class="portlet-body">
                                                <div class="row">
                                                    <input type="hidden" id="productoSelected">

                                                    <div class="col-xs-12" style="height: 290px;">
                                                        <div id="div_productosPrecio_tree" class="col-xs-3"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="col-xs-3">

                                        <div class="form-group">
                                            <label for="codigo"
                                                   class="control-label col-xs-offset-1"> {{ form_label(form.um) }}</label>
                                            <div class="col-xs-12">
                                                {{ form_widget(form.um) }}
                                                {{ form_errors(form.um) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>

                                        <div class="form-group">
                                            <label for="codigo"
                                                   class=" control-label col-xs-offset-1"> {{ form_label(form.preciomn) }}</label>

                                            <div class="col-xs-12">
                                                {{ form_widget(form.preciomn) }}
                                                {{ form_errors(form.preciomn) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>

                                        <div class="form-group">
                                            <label for="codigo"
                                                   class=" control-label col-xs-offset-1"> {{ form_label(form.preciocuc) }}</label>

                                            <div class="col-xs-12">
                                                {{ form_widget(form.preciocuc) }}
                                                {{ form_errors(form.preciocuc) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>
                                        <div class="form-group">
                                            <label for="codigo"
                                                   class=" control-label col-xs-offset-1"> {{ form_label(form.impuesto) }}</label>
                                            <div class="col-xs-12">
                                                {{ form_widget(form.impuesto) }}
                                                {{ form_errors(form.impuesto) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>

                                        <div class="form-group">
                                            <label for="codigo"
                                                   class=" control-label col-xs-offset-1"> {{ form_label(form.resolucion) }}</label>
                                            <div class="col-xs-12">
                                                {{ form_widget(form.resolucion) }}
                                                {{ form_errors(form.resolucion) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>

                                        <div class="form-group">
                                            <label for="codigo"
                                                   class=" control-label col-xs-offset-1"> {{ form_label(form.fecha) }}</label>
                                            <div class="col-xs-12">
                                                {{ form_widget(form.fecha) }}
                                                {{ form_errors(form.fecha) }}
                                            </div>
                                            <small style="display: none;"
                                                   class="help-block col-sm-offset-3 col-sm-9"></small>
                                        </div>

                                    </div>

                                </div>
                            </fieldset>
                            <fieldset style="padding-top: 20px">
                                <div class="col-xs-12 "><p class="mensaje-info"><span
                                                class="glyphicon glyphicon-info-sign"></span> Debe llenar al menos uno
                                        de los campos: Precio CUC o Precio CUP.</p></div>
                                <div class="form-group">
                                    <div class="col-sm-6 col-sm-offset-6">
                                        <button title="Guardar" type="submit" id="btn_agregar_precio"
                                                data-action="agregar"
                                                data-ajax-url="{{ path('precio_new') }}" data-accion="agregar"
                                                class="btn btn-primary   disabled">
                                            <i class="glyphicon glyphicon-save icon-white"></i>
                                            Guardar
                                        </button>
                                        <button title="Aceptar" type="submit" id="btn_add_precio" data-action="aceptar"
                                                class="btn btn-primary disabled  ">
                                            <i class="glyphicon glyphicon-ok icon-white"></i>
                                            Aceptar
                                        </button>
                                        <a href="{{ path('precio_index') }}" id="btn_cerrar"
                                           class="btn btn-default ">
                                            <i class="glyphicon glyphicon-remove icon-white"></i>
                                            Cancelar
                                        </a>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        {{ form_rest(form) }}
                        {{ form_end(form) }}
                    </div>

                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript"
            src="{{ asset('bundles/tercero/js/jquery-easyui-1.5.2/jquery.easyui.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/tercero/js/jstree/dist/jstree.js') }}"></script>
    {% block otherscript %}
        <script type="text/javascript">

            $.fn.datepicker.defaults.format = "dd/mm/yyyy";

            $('.js-datepicker').datepicker({
                endDate: '{{ 'tomorrow' |date('d/m/Y') }}',
                onSelect: function (date) {
                    alert(date)
                },
                todayHighlight: true,
                pickTime: false,
                autoclose: true,
                language: 'es'
            });

            window.array_entidades = [];
            window.array_productos = [];
            //  $.jstree.defaults.checkbox.three_state = false;
            tree_productos = $('#div_productosPrecio_tree');
            tree_productos.jstree({
                'plugins': ["checkbox"],
                'core': {
                    'data': {
                        'url': '{{ path('producto_tree') }}',
                        'data': function (node) {
                            return {'id': node.id};
                        }
                    },
                    'themes': {"responsive": false},
                    "multiple": true
                }
            });

            $('#div_productosPrecio_tree').on("changed.jstree", function (e, data) {
                window.array_productos = data.selected;
                $('#nom_precio_producto').attr('value', data.selected);
                validarBtn();
                if (!data.node) return;
            });

            tree = $('#div_entidades_tree');
            tree.jstree({
                'plugins': ["checkbox"],
                'core': {
                    'data': {
                        'url': '{{ path('grupointeres_tree') }}',
                        'data': function (node) {
                            return {'id': node.id};
                        }
                    },
                    'themes': {"responsive": false},
                    "multiple": true
                }
            });

            window.ctrlKeyPressed = false;
            jQuery(window).keydown(function (e) {
                if (e.keyCode == 17) window.ctrlKeyPressed = true;
            });

            /*$('#div_entidades_tree').on("select_node.jstree", function (e, data) {
                $('#div_entidades_tree').jstree('open_all', data.node.id);
            });*/

            $('#div_entidades_tree').on("changed.jstree", function (e, data) {
                window.array_entidades = data.selected;
                $('#nom_precio_grupo').attr('value', data.selected);
                validarBtn();
                if (!data.node) return;
                var state = data.node.state.selected;
            });

            $('#nom_precio_preciomn,#nom_precio_preciocuc,#nom_precio_impuesto').keyup(function () {

                validarBtn();

                if ($('#nom_precio_preciocuc').val() != '' && $('#nom_precio_preciomn').val() != ''
                    && $('#nom_precio_preciocuc').val() > 0 && $('#nom_precio_preciomn').val() > 0)
                    $('#nom_precio_impuesto').attr('disabled', true).val('');
                else
                    $('#nom_precio_impuesto').removeAttr('disabled');
            });
            $('#nom_precio_um').change(function () {
                validarBtn();

            });


            function validarBtn() {
                if (window.array_productos.length > 0 && window.array_entidades.length > 0
                    && $('#nom_precio_um').val() != ''
                    && ($('#nom_precio_preciomn').val() != '' || $('#nom_precio_preciocuc').val() != '')
                    && ($('#nom_precio_preciomn').val() != '0' || $('#nom_precio_preciocuc').val() != '0') && $('#form-precio').valid()
                )
                    $('#btn_agregar_precio,#btn_add_precio').removeClass('disabled');
                else
                    $('#btn_agregar_precio,#btn_add_precio').addClass('disabled');
            }

            $('#btn_agregar_precio,#btn_add_precio').click(function () {
                $('#nom_precio_action').val($(this).data('action'))
            });

        </script>
    {% endblock %}
{% endblock %}